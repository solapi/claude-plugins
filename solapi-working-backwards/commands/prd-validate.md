---
name: prd-validate
description: PRD 문서를 검증하고 승인/반려 결과를 반환합니다.
arguments:
  - name: file_path
    description: 검증할 PRD 파일 경로 (생략 시 가장 최근 Draft 상태 문서)
    required: false
---

# PRD 검증

## 지시사항

PRD 문서를 PRFAQ 일관성 및 기술 완성도 기준으로 검증합니다.

### 1단계: 검증 대상 문서 확인

파일 경로가 지정된 경우:
- 해당 파일을 읽어옵니다.

파일 경로가 지정되지 않은 경우:
- `docs/working-backwards/` 디렉토리에서 가장 최근 PRD 문서를 찾습니다.
- Draft 또는 In Review 상태인 문서를 우선합니다.

```bash
ls -t docs/working-backwards/PRD-*.md 2>/dev/null | head -5
```

### 2단계: 연결된 PRFAQ 확인

PRD 문서에서 참조하는 PRFAQ를 확인합니다:
- PRFAQ가 존재하는가?
- PRFAQ가 Approved 상태인가?

PRFAQ가 Approved 상태가 아니면 즉시 반려:

```
❌ PRD 검증 실패: 사전 조건 미충족

연결된 PRFAQ가 승인 상태가 아닙니다.

PRFAQ 파일: {파일 경로}
PRFAQ 상태: {현재 상태}

다음 단계:
1. 먼저 PRFAQ를 승인받으세요.
2. `/solapi-working-backwards:prfaq-validate` 명령을 실행하세요.
```

### 3단계: validator 에이전트 호출

validator 에이전트(`agents/validator.md`)를 사용하여 검증을 수행합니다.

### 4단계: 검증 체크리스트 확인

#### 필수 검증 항목 (하나라도 실패 시 반려)

| 항목 | 검증 기준 |
|------|----------|
| **PRFAQ 일관성** | PRD의 목표/범위가 PRFAQ의 고객 혜택/경험과 일치하는가? |
| **기술 요구사항** | 최소 1개 이상의 기능 요구사항이 명확히 정의되어 있는가? |
| **범위 정의** | In Scope와 Out of Scope가 명확히 구분되어 있는가? |
| **의존성 식별** | 내부/외부 의존성이 식별되어 있는가? (없으면 "없음" 명시) |
| **위험 요소** | 최소 1개 이상의 위험 요소와 대응책이 있는가? |
| **검증 기준** | 최소 1개 이상의 Acceptance Criteria가 있는가? |

#### 일관성 검증 세부 항목

| PRFAQ 항목 | PRD 항목 | 검증 |
|-----------|---------|------|
| 고객 정의 | 기능 대상 | 동일한가? |
| 핵심 혜택 | 기능 요구사항 | 혜택을 달성하는가? |
| 성공 지표 | 검증 기준 | 지표를 측정할 수 있는가? |
| 고객 경험 | 사용자 흐름 | 경험을 구현하는가? |

#### 권장 검증 항목 (경고만 표시)

| 항목 | 검증 기준 |
|------|----------|
| 비기능 요구사항 | 성능/보안/확장성 중 하나 이상 정의 |
| 시스템 설계 | 아키텍처 또는 데이터 모델 정의 |
| 테스트 전략 | 테스트 종류와 범위 정의 |
| 구현 계획 | 마일스톤 또는 작업 분해 정의 |

### 5단계: 검증 결과 판정

#### ✅ Approved (승인)
- 모든 필수 검증 항목 통과
- PRFAQ와의 일관성 확인
- 문서 상태를 `Approved`로 업데이트
- 검증 이력에 기록

#### ❌ Rejected (반려)
- 필수 검증 항목 중 하나 이상 실패
- 또는 PRFAQ와의 불일치 발견
- 문서 상태를 `Rejected`로 업데이트
- 구체적인 반려 사유 제시
- 개선 제안 포함

### 6단계: 결과 보고

#### 승인 시 출력 형식:

```
✅ PRD 검증 결과: Approved

📄 문서: {파일 경로}
🔗 PRFAQ: {PRFAQ 파일 경로}
📅 검증 일시: {YYYY-MM-DD HH:mm}

검증 결과:
✅ PRFAQ 일관성: 통과
✅ 기술 요구사항: 통과 (N개 정의됨)
✅ 범위 정의: 통과
✅ 의존성 식별: 통과
✅ 위험 요소: 통과 (N개 식별됨)
✅ 검증 기준: 통과 (N개 정의됨)

⚠️ 권장 사항:
- {있는 경우 권장 개선 사항}

🎉 PRFAQ와 PRD가 모두 승인되었습니다!
이제 구현을 시작할 수 있습니다.

다음 단계:
- 코드 작성을 시작하세요.
- PRD의 기능 요구사항과 검증 기준을 참고하세요.
```

#### 반려 시 출력 형식:

```
❌ PRD 검증 결과: Rejected

📄 문서: {파일 경로}
🔗 PRFAQ: {PRFAQ 파일 경로}
📅 검증 일시: {YYYY-MM-DD HH:mm}

검증 결과:
✅ PRFAQ 일관성: 통과
❌ 기술 요구사항: 실패
   └─ 사유: {구체적인 실패 사유}
   └─ 개선 제안: {어떻게 수정해야 하는지}
✅ 범위 정의: 통과
...

PRFAQ-PRD 불일치 항목:
- {불일치 항목 1}: PRFAQ에서는 X, PRD에서는 Y
- {불일치 항목 2}: ...

반려 사유 요약:
1. {반려 사유 1}
2. {반려 사유 2}

다음 단계:
1. 위 반려 사유를 참고하여 PRD를 수정하세요.
2. PRFAQ와의 일관성을 확인하세요.
3. 수정 후 다시 `/solapi-working-backwards:prd-validate` 명령을 실행하세요.
```

### 7단계: 문서 업데이트

검증 결과에 따라 PRD 문서를 업데이트합니다:

1. **Status** 필드 업데이트 (Draft → Approved/Rejected)
2. **Last Updated** 필드 업데이트
3. **검증 체크리스트** 체크 상태 업데이트 (⬜ → ✅/❌)
4. **검증 이력** 테이블에 새 행 추가

## 반려 기준 상세

### PRFAQ 불일치 예시:
- ❌ PRFAQ: "로그인 시간 50% 단축" → PRD: 성능 요구사항 없음
- ❌ PRFAQ: "관리자를 위한 기능" → PRD: 일반 사용자 대상
- ❌ PRFAQ: "모바일 우선" → PRD: 데스크톱만 언급

### 기술 요구사항 불충분 예시:
- ❌ "사용자가 로그인할 수 있다" - 구체적이지 않음
- ✅ "FR-1: 이메일/비밀번호로 로그인 - 이메일 형식 검증, 비밀번호 최소 8자, 5회 실패 시 잠금"

### 검증 기준 불충분 예시:
- ❌ "로그인이 작동해야 함" - 테스트 불가
- ✅ "Given 등록된 사용자가 있을 때, When 올바른 자격 증명으로 로그인하면, Then JWT 토큰이 반환되고 대시보드로 리다이렉트된다"
